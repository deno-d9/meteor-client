-- MM2 AutoFarm Script - Part 1/2
-- Tween speed: 30
-- All toggles auto-enabled

if not game:IsLoaded() then
    game.Loaded:Wait()
end

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local Player = Players.LocalPlayer

-- Remote Events
local CoinCollectedEvent = game.ReplicatedStorage.Remotes.Gameplay.CoinCollected
local RoundStartEvent = game.ReplicatedStorage.Remotes.Gameplay.RoundStart
local RoundEndEvent = game.ReplicatedStorage.Remotes.Gameplay.RoundEndFade

-- GUI Setup
local MainGui = Instance.new("ScreenGui")
MainGui.Name = "MM2AutoFarm"
MainGui.Parent = CoreGui

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 200)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.Parent = MainGui

-- Title
local Title = Instance.new("TextLabel")
Title.Text = "MM2 Auto Farm"
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Parent = MainFrame

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Text = "X"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -30, 0, 0)
CloseButton.Parent = MainFrame

-- Toggle Buttons
local function CreateToggle(name, yPos)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0.9, 0, 0, 30)
    frame.Position = UDim2.new(0.05, 0, yPos, 0)
    frame.BackgroundTransparency = 1
    frame.Parent = MainFrame

    local label = Instance.new("TextLabel")
    label.Text = name
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextColor3 = Color3.new(1, 1, 1)
    label.Parent = frame

    local toggle = Instance.new("TextButton")
    toggle.Name = name.."Toggle"
    toggle.Size = UDim2.new(0.25, 0, 1, 0)
    toggle.Position = UDim2.new(0.75, 0, 0, 0)
    toggle.Text = "OFF"
    toggle.TextColor3 = Color3.new(1, 1, 1)
    toggle.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    toggle.Parent = frame

    return toggle
end

-- Create Toggles
local AutoFarmToggle = CreateToggle("AutoFarm", 0.2)
local RareEggsToggle = CreateToggle("RareEggs", 0.4)
local NoRenderToggle = CreateToggle("NoRender", 0.6)

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Text = "Status: Ready"
StatusLabel.Size = UDim2.new(1, 0, 0, 30)
StatusLabel.Position = UDim2.new(0, 0, 0.8, 0)
StatusLabel.TextColor3 = Color3.new(1, 1, 1)
StatusLabel.Parent = MainFrame

-- Make draggable
local UserInputService = game:GetService("UserInputService")
local dragging = false
local dragInput, dragStart, startPos

local function Update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        Update(input)
    end
end)

-- Close functionality
CloseButton.MouseButton1Click:Connect(function()
    MainGui:Destroy()
end)

-- Auto enable all toggles
AutoFarmToggle.Text = "ON"
AutoFarmToggle.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
RareEggsToggle.Text = "ON"
RareEggsToggle.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
NoRenderToggle.Text = "ON"
NoRenderToggle.BackgroundColor3 = Color3.fromRGB(0, 170, 0)

-- Anti-AFK
local VirtualUser = game:GetService("VirtualUser")
game:GetService("Players").LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)
-- MM2 AutoFarm Script - Part 2/2
-- Tween speed: 30
-- All toggles auto-enabled

-- Toggle functionality
local AutoFarmEnabled = true
local RareEggsEnabled = true
local NoRenderEnabled = true

AutoFarmToggle.MouseButton1Click:Connect(function()
    AutoFarmEnabled = not AutoFarmEnabled
    if AutoFarmEnabled then
        AutoFarmToggle.Text = "ON"
        AutoFarmToggle.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
    else
        AutoFarmToggle.Text = "OFF"
        AutoFarmToggle.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
    end
end)

RareEggsToggle.MouseButton1Click:Connect(function()
    RareEggsEnabled = not RareEggsEnabled
    if RareEggsEnabled then
        RareEggsToggle.Text = "ON"
        RareEggsToggle.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
    else
        RareEggsToggle.Text = "OFF"
        RareEggsToggle.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
    end
end)

NoRenderToggle.MouseButton1Click:Connect(function()
    NoRenderEnabled = not NoRenderEnabled
    if NoRenderEnabled then
        NoRenderToggle.Text = "ON"
        NoRenderToggle.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
        RunService:Set3dRenderingEnabled(false)
    else
        NoRenderToggle.Text = "OFF"
        NoRenderToggle.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
        RunService:Set3dRenderingEnabled(true)
    end
end)

-- Autofarm variables
local AutofarmActive = false
local FullBasket = false
local SavePosition = nil

function GetCoinContainer()
    for _, v in workspace:GetChildren() do
        if v:FindFirstChild("CoinContainer") then
            return v.CoinContainer
        end
    end
    return nil
end

function CreateSavePoint()
    local part = Instance.new("Part")
    part.Size = Vector3.new(10, 1, 10)
    part.Position = Player.Character.HumanoidRootPart.Position + Vector3.new(0, 100, 0)
    part.Anchored = true
    part.Transparency = 1
    part.Parent = workspace
    SavePosition = part.CFrame * CFrame.new(0, 5, 0)
end

CoinCollectedEvent.OnClientEvent:Connect(function(coinType, current, max)
    if coinType == "Egg" then
        if current == max then
            FullBasket = true
            CreateSavePoint()
            Player.Character.HumanoidRootPart.CFrame = SavePosition
            StatusLabel.Text = "Status: Full Basket (Waiting)"
        else
            FullBasket = false
            StatusLabel.Text = "Status: Farming"
        end
    end
end)

-- Main farming function with tween speed 30
spawn(function()
    while wait() do
        if AutoFarmEnabled and Player.Character and GetCoinContainer() then
            local nearestCoin = nil
            local minDistance = math.huge
            
            for _, coin in pairs(GetCoinContainer():GetChildren()) do
                if coin:FindFirstChild("TouchInterest") then
                    local distance = (Player.Character.HumanoidRootPart.Position - coin.Position).Magnitude
                    if distance < minDistance then
                        nearestCoin = coin
                        minDistance = distance
                    end
                end
            end
            
            if nearestCoin and not FullBasket then
                local tween = TweenService:Create(
                    Player.Character.HumanoidRootPart,
                    TweenInfo.new(minDistance / 30, Enum.EasingStyle.Linear),  -- Tween speed 30
                    {CFrame = CFrame.new(nearestCoin.Position)}
                )
                tween:Play()
                tween.Completed:Wait()
            end
        end
        wait(0.1)
    end
end)

-- Rare eggs function
spawn(function()
    while wait() do
        if RareEggsEnabled and GetCoinContainer() then
            for _, coin in pairs(GetCoinContainer():GetChildren()) do
                if coin:GetAttribute("CoinID") == "RareEgg" and coin:FindFirstChildOfClass("MeshPart").Transparency < 0.6 then
                    for i = 1, 30 do  -- Stay on rare egg for 30 frames
                        if Player.Character then
                            Player.Character.HumanoidRootPart.CFrame = coin.CFrame
                        end
                        wait()
                    end
                    if FullBasket then
                        Player.Character.HumanoidRootPart.CFrame = SavePosition
                    end
                end
            end
        end
    end
end)

-- Initialize
StatusLabel.Text = "Status: Farming"
RunService:Set3dRenderingEnabled(false)  -- Start with no render
